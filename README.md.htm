


<!DOCTYPE html>
<html>
  <head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# githubog: http://ogp.me/ns/fb/githubog#">
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>aacl/README.md at master · banks/aacl</title>
    <link rel="search" type="application/opensearchdescription+xml" href="/opensearch.xml" title="GitHub" />
    <link rel="fluid-icon" href="https://github.com/fluidicon.png" title="GitHub" />
    <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon" />

    
    

    <meta content="authenticity_token" name="csrf-param" />
<meta content="LfotBaSLYlSQG7NNRX2/wu1sMtmUFxOxtfbnEunc6FM=" name="csrf-token" />

    <link href="https://a248.e.akamai.net/assets.github.com/stylesheets/bundles/github-28f4e6c4558b18b8da0c46ded21ba2ca0aaea0d0.css" media="screen" rel="stylesheet" type="text/css" />
    <link href="https://a248.e.akamai.net/assets.github.com/stylesheets/bundles/github2-91edb26eeecbdea76badb0303870401293b53de1.css" media="screen" rel="stylesheet" type="text/css" />
    

    <script src="https://a248.e.akamai.net/assets.github.com/javascripts/bundles/jquery-cd3aa6c909bc9018f484738538d9d29876972a67.js" type="text/javascript"></script>
    <script src="https://a248.e.akamai.net/assets.github.com/javascripts/bundles/github-0a64955c2945e25654a16c57f3566463769a69b8.js" type="text/javascript"></script>
    

      <link rel='permalink' href='/banks/aacl/blob/2cef0e84af0b8f99a4403c255801f05360e4c0c1/README.md'>
    <meta property="og:title" content="aacl"/>
    <meta property="og:type" content="githubog:gitrepository"/>
    <meta property="og:url" content="https://github.com/banks/aacl"/>
    <meta property="og:image" content="https://a248.e.akamai.net/assets.github.com/images/gravatars/gravatar-140.png?1329275898"/>
    <meta property="og:site_name" content="GitHub"/>
    <meta property="og:description" content="aacl - Another ACL for Kohana 3. Please see README.md for a justification of this indulgence."/>

    <meta name="description" content="aacl - Another ACL for Kohana 3. Please see README.md for a justification of this indulgence." />
  <link href="https://github.com/banks/aacl/commits/master.atom" rel="alternate" title="Recent Commits to aacl:master" type="application/atom+xml" />

  </head>


  <body class="logged_in page-blob windows vis-public env-production " data-blob-contribs-enabled="yes">
    
    
    

      <div id="header" class="true clearfix">
        <div class="container clearfix">
          <a class="site-logo" href="https://github.com/">
            <!--[if IE]>
            <img alt="GitHub" class="github-logo" src="https://a248.e.akamai.net/assets.github.com/images/modules/header/logov7.png?1323882736" />
            <img alt="GitHub" class="github-logo-hover" src="https://a248.e.akamai.net/assets.github.com/images/modules/header/logov7-hover.png?1324325373" />
            <![endif]-->
            <img alt="GitHub" class="github-logo-4x" height="30" src="https://a248.e.akamai.net/assets.github.com/images/modules/header/logov7@4x.png?1323882736" />
            <img alt="GitHub" class="github-logo-4x-hover" height="30" src="https://a248.e.akamai.net/assets.github.com/images/modules/header/logov7@4x-hover.png?1324325373" />
          </a>

              
    <div class="topsearch ">
<form accept-charset="UTF-8" action="/search" id="top_search_form" method="get"><input name="utf8" type="hidden" value="&#x2713;" />        <a href="/search" class="advanced-search tooltipped downwards" title="Advanced Search"><span class="mini-icon advanced-search"></span></a>
        <div class="search placeholder-field js-placeholder-field">
          <label class="placeholder" for="global-search-field">Search…</label>
          <input type="text" class="search my_repos_autocompleter" id="global-search-field" name="q" results="5" spellcheck="false" autocomplete="off" data-autocomplete="my-repos-autocomplete">
          <div id="my-repos-autocomplete" class="autocomplete-results">
            <ul class="js-navigation-container"></ul>
          </div>
          <input type="submit" value="Search" class="button">
          <span class="mini-icon search-input"></span>
        </div>
        <input type="hidden" name="type" value="Everything" />
        <input type="hidden" name="repo" value="" />
        <input type="hidden" name="langOverride" value="" />
        <input type="hidden" name="start_value" value="1" />
</form>      <ul class="top-nav">
          <li class="explore"><a href="https://github.com/explore">Explore</a></li>
          <li><a href="https://gist.github.com">Gist</a></li>
          <li><a href="/blog">Blog</a></li>
        <li><a href="http://help.github.com">Help</a></li>
      </ul>
    </div>


            


  <div id="userbox">
    <div id="user">
      <a href="https://github.com/anitha2012"><img height="20" src="https://secure.gravatar.com/avatar/1cc65b18a2b551e943345e8979be0f15?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" width="20" /></a>
      <a href="https://github.com/anitha2012" class="name">anitha2012</a>
    </div>
    <ul id="user-links">
      <li>
        <a href="/inbox/notifications" id="notifications" class="tooltipped downwards" title="Notifications">
          <span class="mini-icon notifications"></span>
        </a>
      </li>
      <li><a href="/settings/profile" id="settings" class="tooltipped downwards" title="Account Settings"><span class="mini-icon account-settings"></span></a></li>
      <li>
        <a href="/logout" data-method="post" id="logout" class="tooltipped downwards" title="Log Out"><span class="mini-icon logout"></span></a>
      </li>
    </ul>
  </div>



          
        </div>
      </div>

      

            <div class="site" itemscope itemtype="http://schema.org/WebPage">
      <div class="container">
        <div class="pagehead repohead instapaper_ignore readability-menu">
        <div class="title-actions-bar">
          <h1 itemscope itemtype="http://data-vocabulary.org/Breadcrumb">
            <span class="mini-icon public-repo"></span>
<a href="/banks" itemprop="url">            <span itemprop="title">banks</span>
            </a> /
            <strong><a href="/banks/aacl" class="js-current-repository">aacl</a></strong>
          </h1>
          



              <ul class="pagehead-actions">


          <li class="js-toggler-container watch-button-container ">
            <a href="/banks/aacl/toggle_watch" class="minibutton btn-watch watch-button js-toggler-target" data-method="post" data-remote="true" rel="nofollow"><span><span class="icon"></span>Watch</span></a>
            <a href="/banks/aacl/toggle_watch" class="minibutton btn-watch unwatch-button js-toggler-target" data-method="post" data-remote="true" rel="nofollow"><span><span class="icon"></span>Unwatch</span></a>
          </li>

              <li><a href="/banks/aacl/fork_select" class="minibutton btn-fork " rel="facebox nofollow"><span><span class="icon"></span>Fork</span></a></li>



      <li class="repostats">
        <ul class="repo-stats">
          <li class="watchers ">
            <a href="/banks/aacl/watchers" title="Watchers" class="tooltipped downwards">
              32
            </a>
          </li>
          <li class="forks">
            <a href="/banks/aacl/network" title="Forks" class="tooltipped downwards">
              7
            </a>
          </li>
        </ul>
      </li>
    </ul>

        </div>

          

  <ul class="tabs">
    <li><a href="/banks/aacl" class="selected" highlight="repo_sourcerepo_downloadsrepo_commitsrepo_tagsrepo_branches">Code</a></li>
    <li><a href="/banks/aacl/network" highlight="repo_networkrepo_fork_queue">Network</a>
    <li><a href="/banks/aacl/pulls" highlight="repo_pulls">Pull Requests <span class='counter'>0</span></a></li>

      <li><a href="/banks/aacl/issues" highlight="repo_issues">Issues <span class='counter'>1</span></a></li>


    <li><a href="/banks/aacl/graphs" highlight="repo_graphsrepo_contributors">Stats &amp; Graphs</a></li>

  </ul>

  
<div class="frame frame-center tree-finder" style="display:none"
      data-tree-list-url="/banks/aacl/tree-list/2cef0e84af0b8f99a4403c255801f05360e4c0c1"
      data-blob-url-prefix="/banks/aacl/blob/2cef0e84af0b8f99a4403c255801f05360e4c0c1"
    >

  <div class="breadcrumb">
    <span class="bold"><a href="/banks/aacl">aacl</a></span> /
    <input class="tree-finder-input js-navigation-enable" type="text" name="query" autocomplete="off" spellcheck="false">
  </div>

    <div class="octotip">
      <p>
        <a href="/banks/aacl/dismiss-tree-finder-help" class="dismiss js-dismiss-tree-list-help" title="Hide this notice forever" rel="nofollow">Dismiss</a>
        <span class="bold">Octotip:</span> You've activated the <em>file finder</em>
        by pressing <span class="kbd">t</span> Start typing to filter the
        file list. Use <span class="kbd badmono">↑</span> and
        <span class="kbd badmono">↓</span> to navigate,
        <span class="kbd">enter</span> to view files.
      </p>
    </div>

  <table class="tree-browser" cellpadding="0" cellspacing="0">
    <tr class="js-header"><th>&nbsp;</th><th>name</th></tr>
    <tr class="js-no-results no-results" style="display: none">
      <th colspan="2">No matching files</th>
    </tr>
    <tbody class="js-results-list js-navigation-container">
    </tbody>
  </table>
</div>

<div id="jump-to-line" style="display:none">
  <h2>Jump to Line</h2>
  <form accept-charset="UTF-8">
    <input name="utf8" type="hidden" value="&#x2713;" />
    <input class="textfield" type="text">
    <div class="full-button">
      <button type="submit" class="classy">
        <span>Go</span>
      </button>
    </div>
  </form>
</div>


<div class="subnav-bar">

  <ul class="actions subnav">
    <li><a href="/banks/aacl/tags" class="blank" highlight="repo_tags">Tags <span class="counter">0</span></a></li>
    <li><a href="/banks/aacl/downloads" class="blank downloads-blank" highlight="repo_downloads">Downloads <span class="counter">0</span></a></li>
    
  </ul>

  <ul class="scope">
    <li class="switcher">

      <div class="context-menu-container js-menu-container">
        <a href="#"
           class="minibutton bigger switcher js-menu-target js-commitish-button btn-branch repo-tree"
           data-master-branch="master"
           data-ref="master">
          <span><span class="icon"></span><i>branch:</i> master</span>
        </a>

        <div class="context-pane commitish-context js-menu-content">
          <a href="javascript:;" class="close js-menu-close"></a>
          <div class="context-title">Switch Branches/Tags</div>
          <div class="context-body pane-selector commitish-selector js-filterable-commitishes">
            <div class="filterbar">
              <div class="placeholder-field js-placeholder-field">
                <label class="placeholder" for="context-commitish-filter-field" data-placeholder-mode="sticky">Filter branches/tags</label>
                <input type="text" id="context-commitish-filter-field" class="commitish-filter" />
              </div>

              <ul class="tabs">
                <li><a href="#" data-filter="branches" class="selected">Branches</a></li>
                <li><a href="#" data-filter="tags">Tags</a></li>
              </ul>
            </div>

              <div class="commitish-item branch-commitish selector-item">
                <h4>
                    <a href="/banks/aacl/blob/master/README.md" data-name="master" rel="nofollow">master</a>
                </h4>
              </div>


            <div class="no-results" style="display:none">Nothing to show</div>
          </div>
        </div><!-- /.commitish-context-context -->
      </div>

    </li>
  </ul>

  <ul class="subnav with-scope">

    <li><a href="/banks/aacl" class="selected" highlight="repo_source">Files</a></li>
    <li><a href="/banks/aacl/commits/master" highlight="repo_commits">Commits</a></li>
    <li><a href="/banks/aacl/branches" class="" highlight="repo_branches" rel="nofollow">Branches <span class="counter">1</span></a></li>
  </ul>

</div>

  
  
  


          

        </div><!-- /.repohead -->

        





<!-- block_view_fragment_key: views7/v8/blob:v19:decbe56c0006836cfeb09d3ba3edfb57 -->
  <div id="slider">

    <div class="breadcrumb" data-path="README.md/">
      <b itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb"><a href="/banks/aacl/tree/2cef0e84af0b8f99a4403c255801f05360e4c0c1" class="js-rewrite-sha" itemprop="url"><span itemprop="title">aacl</span></a></b> / <strong class="final-path">README.md</strong> <span class="js-clippy mini-icon clippy " data-clipboard-text="README.md" data-copied-hint="copied!" data-copy-hint="copy to clipboard"></span>
    </div>


      <div class="commit file-history-tease" data-path="README.md/">
        <img class="main-avatar" height="24" src="https://secure.gravatar.com/avatar/1f6cd5505ff5269bc1a42d34e459070a?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" width="24" />
        <span class="author"><a href="/banks">banks</a></span>
        <time class="js-relative-date" datetime="2010-01-23T07:24:46-08:00" title="2010-01-23 07:24:46">January 23, 2010</time>
        <div class="commit-title">
            <a href="/banks/aacl/commit/2cef0e84af0b8f99a4403c255801f05360e4c0c1" class="message">More typos. You'd of thought someone who spends their entire life cod…</a>
        </div>

        <div class="participation">
          <p class="quickstat"><a href="#blob_contributors_box" rel="facebox"><strong>1</strong> contributor</a></p>
          
        </div>
        <div id="blob_contributors_box" style="display:none">
          <h2>Users on GitHub who have contributed to this file</h2>
          <ul class="facebox-user-list">
            <li>
              <img height="24" src="https://secure.gravatar.com/avatar/1f6cd5505ff5269bc1a42d34e459070a?s=140&amp;d=https://a248.e.akamai.net/assets.github.com%2Fimages%2Fgravatars%2Fgravatar-140.png" width="24" />
              <a href="/banks">banks</a>
            </li>
          </ul>
        </div>
      </div>

    <div class="frames">
      <div class="frame frame-center" data-path="README.md/" data-permalink-url="/banks/aacl/blob/2cef0e84af0b8f99a4403c255801f05360e4c0c1/README.md" data-title="aacl/README.md at master · banks/aacl · GitHub" data-type="blob">

        <div id="files" class="bubble">
          <div class="file">
            <div class="meta">
              <div class="info">
                <span class="icon"><b class="mini-icon text-file"></b></span>
                <span class="mode" title="File Mode">100644</span>
                  <span>301 lines (198 sloc)</span>
                <span>15.795 kb</span>
              </div>
              <ul class="button-group actions">
                  <li>
                    <a class="grouped-button file-edit-link minibutton bigger lighter js-rewrite-sha" href="/banks/aacl/edit/2cef0e84af0b8f99a4403c255801f05360e4c0c1/README.md" data-method="post" rel="nofollow"><span>Edit this file</span></a>
                  </li>

                <li>
                  <a href="/banks/aacl/raw/master/README.md" class="minibutton btn-raw grouped-button bigger lighter" id="raw-url"><span><span class="icon"></span>Raw</span></a>
                </li>
                  <li>
                    <a href="/banks/aacl/blame/master/README.md" class="minibutton btn-blame grouped-button bigger lighter"><span><span class="icon"></span>Blame</span></a>
                  </li>
                <li>
                  <a href="/banks/aacl/commits/master/README.md" class="minibutton btn-history grouped-button bigger lighter" rel="nofollow"><span><span class="icon"></span>History</span></a>
                </li>
              </ul>
            </div>
            
  <div id="readme" class="blob instapaper_body">
    <article class="markdown-body" itemprop="mainContentOfPage"><h1>AACL</h1>

<p>AACL is (yet) Another ACL library for Kohana 3.</p>

<h2>Why another one?</h2>

<p>Simply because none really fitted my needs. I don't for a minute suggest it is inherently better than any others or that you should use this instead of X library - it is just a library that fits my needs.
You are free to use it and/or modify it if you think it will work well for you.</p>

<h3>My Aims</h3>

<p>What makes my needs so incompatible with other libraries? Well, my aims for an ACL are given below. I've not found anything else that was close enough to warrant forking, 
especially since one of my core aims is simplicity and small amounts of clear code.</p>

<p>I need an ACL to:</p>

<ul>
<li><p>define <em>all</em> rules in database so that applications can provide a UI for simple but fine-grained control of user's privileges;</p></li>
<li><p>be flexible enough to actually work in real apps without special-cases and hacks. That means being able to specify rules
such as "Moderators can edit all posts, Normal Users can edit only their own posts";</p></li>
<li><p>be simple enough that you don't need to get your head round arcane and abstract mappings of objects and resources;</p></li>
<li><p>not require you to manually hard code lists of resources and permission types to be later checked against. All resources should be defined naturally with short, functional code, not abstract mappings and list definitions;</p></li>
<li><p>work with Kohana default Auth module. That means non-hierarchical user roles as managing hierarchies can get messy quickly; and</p></li>
<li><p>require a minimal amount of clear code to check permissions in controllers (and potentially anywhere else it may make sense to).</p></li>
</ul><p>If you think you know of an ACL library that fits these needs already then feel free to let me know I've missed it but 
I've not found anything that really got close enough to warrant forking. I will however credit <a href="http://github.com/ollym">Olly Morgan</a> for writing such a simple and neat ACL library that, despite ultimately not being quite what I need, inspired me to
write this.</p>

<h2>User Guide</h2>

<p>This user guide is intended to explain the (hopefully simple) concepts and implementation of AACL. In each section, concepts go first, then implementation then examples.</p>

<h3>Auth integration: Users and Roles</h3>

<p>AACL uses <a href="http://github.com/kohanan/auth">kohana auth</a> module with no additions or modifications. 
Since I use Sprig exclusively, I also use my <a href="http://github.com/banks/sprig-auth">Sprig Auth Driver</a> but if you want to mix and match, 
an ORM User/Auth driver should work just as well.</p>

<p>This means:</p>

<ol>
<li><p>Users and roles have a many-to-many mapping</p></li>
<li><p>Roles are non-hierarchical and no role is given special treatment</p></li>
<li><p>The only exception to 2. is the 'login' role which all active users must have. 
In reality you may choose to special case this in a UI and represent it as an 'active account' checkbox rather 
than requiring end-users to understand that it is different from other roles.</p></li>
</ol><h3>Sprig and other ORMs</h3>

<p>AACL ships with a Sprig based Rule model and Sprig based class for easily turning Sprig models into Access Controlled Resources. 
It should be relatively trivial to modify the library to work with other ORMs but as this is only likely to be used by me for now, a flexible driver system seems unnecessary.</p>

<h3>Concept: ACL Resources</h3>

<p>Any PHP class that implements <code>AACL_Resource</code> interface is considered a resource. This means that just by implementing it, rules can be added based on that object.</p>

<p>AACL ships with two abstract Resource classes <code>Controller_AACL</code> and <code>Sprig_AACL</code> which allow any extending controllers or models to automatically become valid resources
against which access rules can be created.</p>

<h4>AACL_Resource Interface</h4>

<p>The <code>AACL_Resource</code> interface defines four methods:</p>

<ul>
<li>
<p><strong>public function acl_id()</strong></p>

<p>Must return a string that uniquely identifies the current object as a resource.
Convention is for controllers to return as <code>c:controller_name</code> and models as <code>m:model_name.primary_key_value</code>
Remember that dot in model identifier - it is significant!</p>
</li>
<li>
<p><strong>public function acl_actions($return_current = FALSE)</strong></p>

<p>This method servers a dual purpose. When the argument <code>$return_current</code> is false, the method should return an array of string names, one for each action
that can be carried out on the resource. For no specific actions, an empty array should be returned.</p>

<ul>
<li> <code>Controller_AACL</code> returns an array containing the names of all public action methods automatically.</li>
<li> <code>Sprig_AACL</code> returns actions 'create', 'read', 'update', 'delete'. These can be changed by overriding this method in specific models.</li>
</ul>
</li>
<li>
<p><strong>public function acl_conditions(Model_User $user = NULL, $condition = NULL)</strong></p>

<p>This method also servers a dual purpose: it both defines available conditions and checks them.</p>

<ul>
<li> When both arguments are NULL, the function should return an array containing information about any special conditions the resource supports. More on what conditions are below.
The format of this array is <code>array('condition_id' =&gt; 'Nice description for UIs')</code>.</li>
<li> When a user object and condition id are passed, the funtion should return a boolean indicating whether or not the condition has passed.</li>
</ul>
</li>
<li>
<p><strong>public static function acl_instance($class_name)</strong></p>

<p>This method is used for auto-discovery of available resources. Since the resource ID, actions and conditions must be obtained from an object, 
we need a way to get and instance of the object given only the class name. Not that the object returned shoul not be used for anything except calling <code>acl_*</code> methods
to discover resource properties. </p>
</li>
</ul><p>Note that the <code>Model_AACL_Rule</code> itself extends <code>Sprig_AACL</code>. Instead of the default CRUD actions though it just specifies <code>grant</code> and <code>revoke</code> actions. This means you can
create rules about whether a role can itsef grant or revoke access! Note that the checking is not automatic though. That would prevent installers from creating rules or similar
due to not having a user logged in yet! It is still up to the developer to check the user has permission to grant or revoke using check().</p>

<h3>Resource Conditions</h3>

<p><code>AACL_Resource</code> objects can define conditions which allow rules to provide fine-grained control. Since conditions are resource specific, only conditions defined by the resource
are available when defining rules for that resource.</p>

<p>A typical and common use for this is allowing Users to edit their own posts but not others'. The implementation for such a condition is given below.</p>

<pre><code>// Sprig_AACL defines the AACL_Request interface but with no available conditions (since they will be model-specifc)
// We don't need to redefine the acl_id() or acl_actions() methods as long as we are happy with the defaults

class Model_Post extends Sprig_AACL
{
    ... Set up model ...

    public function acl_conditions(Model_User $user = NULL, $condition = NULL)
    {
        if (is_null($user) OR is_null($condition))
        {
            // Return condition definition(s)
            // Here we only have one condition but we could have many
            return array(
                'is_author' =&gt; 'user is post author',
            );
        }
        else
        {
            // Condition logic goes here. Complex condition logic could be implemented in another method and called here.
            switch ($condition)
            {
                case 'is_author':
                    // Return TRUE if the post author matches the passed user id
                    return ($this-&gt;author_id === $user-&gt;id);

                default:
                    // Condition doesn't exist therefore fails
                    return FALSE;
            }
        }
    }
}
</code></pre>

<p>As you have probably guessed, <code>$user</code> is populated by the logged in user object when the rule is evaluated so conditions allow a neat 
and simple way of adding fine-grained user/resource specific rules in a general way.</p>

<h3>AACL Rules</h3>

<p>Once you have some Controllers, Models or other objects defined as AACL_Resources, you can grant access to specific user roles.</p>

<p>The first major concept here is that rules are ONLY 'allow' type rules. 
This is to keep things simple and to prevent the need for having a role hierarchy to decide which rules take precedence.</p>

<p>Once <code>AACL::check($resource)</code> has been called, the user must be granted access to <code>$resource</code> by at least one rule otherwise the check fails.</p>

<p>Rules do have a simple inheritance to them in that they can be made more or less specific by their definitions.</p>

<p>A rule is defined using the <code>grant()</code> function described below:</p>

<p><strong>AACL::grant(mixed $role, string $resource_id, string $action = NULL, string $condition = NULL)</strong></p>

<p>Params:</p>

<ul>
<li>
<p><strong>$role</strong></p>

<p>Can be either a <code>Model_Role</code> object or a string role name. This is the role that the rule applies to.</p>
</li>
<li>
<p><strong>$resource_id</strong></p>

<p>A string identifying the resource the rule applies to. Note that dots in resource IDs indicate a level or specificity. 
For example, <code>m:post.34</code> would grant access to Model_Post object with id 34, <code>m:post</code> would grant access to all post objects.
The wildcard <code>*</code> can also be used (alone) to match any resource. This will grant the role in question complete access to everything though so is
probably only going to be used, at most, for only one role per application!</p>
</li>
<li>
<p><strong>$action</strong></p>

<p>Specifies a specific action of that resource which may be accessed. For example if role is <code>m:post</code> and action is <code>delete</code>, access will be granted to delete any post object.
If the action is NULL or does not exist (i.e. is not returned by the resource's acl_actions() method) then access will be granted for any action on the resource.</p>
</li>
<li>
<p><strong>$conditions</strong></p>

<p>Specifies a condition of the resource which must be met to allow access. For example, <code>AACL::grant('login', 'm:post', 'edit', 'is_author');</code> 
allows any user access to edit a post <em>provided</em> that they are the post's author. If the condition string passed doesn't match a valid condition 
returned by <code>$resource-&gt;acl_conditions()</code> then the rule will NEVER match!</p>
</li>
</ul><p>To grant access to multiple (but not all) actions of a resource, multiple rules should be used. For example:</p>

<pre><code>AACL::grant('admin', 'm:post');                         // Grant all rights to admins for post objects

AACL::grant('moderator', 'm:post', 'view');             // Moderators can view...
AACL::grant('moderator', 'm:post', 'edit');             // ... or edit any post

AACL::grant('login', 'm:post', 'view');                 // Normal users can view all posts...
AACL::grant('login', 'm:post', 'edit', 'is_author');    // ... but only edit their own

AACL::grant('sales', 'm:page.32', 'edit');              // Sales team can edit page with ID 32 (ths is probably vital 
                                                        // for one of their campaigns...) but no other pages
</code></pre>

<h4>Revoking access</h4>

<p><code>AACL::revoke()</code> is used to remove rules and accepts exactly the same arguments used to grant the rules. 
Note that the arguments don't have to exactly match a defined rule to delete it. For example</p>

<pre><code>AACL::grant('staff', 'm:post', 'edit');                 // 1
AACL::grant('staff', 'm:post', 'delete');               // 2
AACL::grant('staff', 'm:comment', 'delete');            // 3

AACL::revoke('staff', 'm:post', 'edit');                // Removes 1 from above
AACL::revoke('staff', 'm:post');                        // Removes 1 AND 2 from above
AACL::revoke('staff', '*');                             // Removes all rules for 'staff' (i.e. they now have access to nothing)
</code></pre>

<h4>Rule Specificity</h4>

<p>If you grant a rule which is <em>more</em> permissive than one or more rules that currently exist, the current rules will be automatically deleted since they are now logically useless.</p>

<h3>Checking Permissions</h3>

<p>One of the key requirements for this library is to make checking access rights as simple and clear as possible.</p>

<p>All checking is done using <code>AACL::check()</code> described below:</p>

<p><strong>AACL::check(AACL_Resource $resource, $action = NULL)</strong></p>

<ul>
<li>
<p><strong>$resource</strong> </p>

<p>The AACL_Resource being requested. <code>check()</code> will attempt to get the current action from the resource automatically
using <code>$reource-&gt;acl_actions(TRUE)</code>. If this returns a string action then that action will be used for checking without having to specify the <code>$action</code> parameter.</p>

<p>Note that the string resource ID can't be specified since the <code>check()</code> function requires access to the objects acl_* methods. It
is simpler not to have to define mappings from id back to class name in some separate global class in order to create instances.
If I think of a way to make this neat and relatively seemless I may implement it but I don't feel this is a big issue.</p>

<p>This does mean that currently there is no real way to check permisions on a controller resource other than the one in which the call to <code>AACL::check()</code> resides. 
In practice this is unlikely to be a real limitiation.</p>

<p>Since a controller object knows the currently executing action, the current controller action can be checked simply with <code>AACL::check($this)</code>.
Since models don't inherently know which action is being requested, <code>$action</code> parameter must be specified otherwise the user will need to have access to ALL actions
of the resource for the check to pass.</p>

<p>Since controllers inherently know about the currently executing action, all actions in a controller will automatically be protected (according to their action-specific 
rules) simply by calling <code>AACL::check($this)</code> in the controller's <code>before()</code> method.</p>
</li>
<li>
<p><strong>$action</strong> </p>

<p>If the resource doesn't know inherently which action is being requested, it can be specified here. If specified here, it will over-ride the 
action the resource object claims to be executing. So to check the permission of a <em>different</em> action of the same controller 
(not sure why you would want to but still...) you could use:</p>

<pre><code>public function action_one()
{
    // Check permission for this action
    AACL::check($this);

    // Check permission for other action
    AACL::check($this, 'other');
}
</code></pre>
</li>
</ul><h4>Failing check()</h4>

<p>If the user doesn't have access to the required object and action, AACL throws an exception which must be handled to resolve the issue.</p>

<p>If the user isn't logged in, a <code>AACL_Exception_401</code> is thrown which should be caught and the user re-directed to a login form.</p>

<p>If the user is logged in but lacks the privileges to access a resource, an <code>AACL_Exception_403</code> is throw. 
It is left to the developer to catch this and display an appropriate message.</p>

<p>These should both be caught in <code>bootstrap.php</code> something like this:</p>

<pre><code>$request = Request::instance($uri);

try
{
    $request-&gt;execute();
}
catch (AACL_Exception_401 $e)
{
    // Redirect to login
}
catch (AACL_Exception_403 $e)
{
    // Issue request for access denied page or just display a template
}

echo $request
        -&gt;send_headers()
        -&gt;response;
</code></pre>

<h3>Listing Resources</h3>

<p>A major motivation for this library is to make it easy to create Rules using a UI. To facilitate this, all potential resources defined in the application can be found using
<code>AACL::list_resources()</code>. This returns a multi-dimensional array listing all the resources and any actions or conditions they define.</p>

<p>It works by scanning the file system and using reflection so in a big app this is likely to take some time. I feel that is not a big deal here though as it should only ever be done in 
admin control panels not in public parts of the app and it allows a very powerful system that doesn't require maintaining lenthly and complex mappings of classes and resources.</p>

<p>Note that <code>list_resources()</code> will only return the basic types in the case of models, not every possible model id. In other words you will get a single entry 
for <code>m:post</code> rather than <code>m:post.1, m:post.2, ...</code>. It is left for the developer to retrieve this data if necessary for a UI.</p>

<h3>UI</h3>

<p>A basic rule management UI will hopefully be added to the module at some point to help get started. It will naturally be disabled in all but 'developement' environment.</p></article>
  </div>

          </div>
        </div>
      </div>
    </div>

  </div>

<div class="frame frame-loading large-loading-area" style="display:none;" data-tree-list-url="/banks/aacl/tree-list/2cef0e84af0b8f99a4403c255801f05360e4c0c1" data-blob-url-prefix="/banks/aacl/blob/2cef0e84af0b8f99a4403c255801f05360e4c0c1">
  <img src="https://a248.e.akamai.net/assets.github.com/images/spinners/octocat-spinner-64.gif?1329872009" height="64" width="64">
</div>

      </div>
      <div class="context-overlay"></div>
    </div>


      <!-- footer -->
      <div id="footer" >
        
  <div class="upper_footer">
     <div class="container clearfix">

       <!--[if IE]><h4 id="blacktocat_ie">GitHub Links</h4><![endif]-->
       <![if !IE]><h4 id="blacktocat">GitHub Links</h4><![endif]>

       <ul class="footer_nav">
         <h4>GitHub</h4>
         <li><a href="https://github.com/about">About</a></li>
         <li><a href="https://github.com/blog">Blog</a></li>
         <li><a href="https://github.com/features">Features</a></li>
         <li><a href="https://github.com/contact">Contact &amp; Support</a></li>
         <li><a href="https://github.com/training">Training</a></li>
         <li><a href="http://enterprise.github.com/">GitHub Enterprise</a></li>
         <li><a href="http://status.github.com/">Site Status</a></li>
       </ul>

       <ul class="footer_nav">
         <h4>Tools</h4>
         <li><a href="http://get.gaug.es/">Gauges: Analyze web traffic</a></li>
         <li><a href="http://speakerdeck.com">Speaker Deck: Presentations</a></li>
         <li><a href="https://gist.github.com">Gist: Code snippets</a></li>
         <li><a href="http://mac.github.com/">GitHub for Mac</a></li>
         <li><a href="http://mobile.github.com/">Issues for iPhone</a></li>
         <li><a href="http://jobs.github.com/">Job Board</a></li>
       </ul>

       <ul class="footer_nav">
         <h4>Extras</h4>
         <li><a href="http://shop.github.com/">GitHub Shop</a></li>
         <li><a href="http://octodex.github.com/">The Octodex</a></li>
       </ul>

       <ul class="footer_nav">
         <h4>Documentation</h4>
         <li><a href="http://help.github.com/">GitHub Help</a></li>
         <li><a href="http://developer.github.com/">Developer API</a></li>
         <li><a href="http://github.github.com/github-flavored-markdown/">GitHub Flavored Markdown</a></li>
         <li><a href="http://pages.github.com/">GitHub Pages</a></li>
       </ul>

     </div><!-- /.site -->
  </div><!-- /.upper_footer -->

<div class="lower_footer">
  <div class="container clearfix">
    <!--[if IE]><div id="legal_ie"><![endif]-->
    <![if !IE]><div id="legal"><![endif]>
      <ul>
          <li><a href="https://github.com/site/terms">Terms of Service</a></li>
          <li><a href="https://github.com/site/privacy">Privacy</a></li>
          <li><a href="https://github.com/security">Security</a></li>
      </ul>

      <p>&copy; 2012 <span title="0.08907s from fe8.rs.github.com">GitHub</span> Inc. All rights reserved.</p>
    </div><!-- /#legal or /#legal_ie-->

      <div class="sponsor">
        <a href="http://www.rackspace.com" class="logo">
          <img alt="Dedicated Server" height="36" src="https://a248.e.akamai.net/assets.github.com/images/modules/footer/rackspaces_logo.png?1329521041" width="38" />
        </a>
        Powered by the <a href="http://www.rackspace.com ">Dedicated
        Servers</a> and<br/> <a href="http://www.rackspacecloud.com">Cloud
        Computing</a> of Rackspace Hosting<span>&reg;</span>
      </div>
  </div><!-- /.site -->
</div><!-- /.lower_footer -->

      </div><!-- /#footer -->

    

<div id="keyboard_shortcuts_pane" class="instapaper_ignore readability-extra" style="display:none">
  <h2>Keyboard Shortcuts <small><a href="#" class="js-see-all-keyboard-shortcuts">(see all)</a></small></h2>

  <div class="columns threecols">
    <div class="column first">
      <h3>Site wide shortcuts</h3>
      <dl class="keyboard-mappings">
        <dt>s</dt>
        <dd>Focus site search</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>?</dt>
        <dd>Bring up this help dialog</dd>
      </dl>
    </div><!-- /.column.first -->

    <div class="column middle" style='display:none'>
      <h3>Commit list</h3>
      <dl class="keyboard-mappings">
        <dt>j</dt>
        <dd>Move selection down</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>k</dt>
        <dd>Move selection up</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>c <em>or</em> o <em>or</em> enter</dt>
        <dd>Open commit</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>y</dt>
        <dd>Expand URL to its canonical form</dd>
      </dl>
    </div><!-- /.column.first -->

    <div class="column last" style='display:none'>
      <h3>Pull request list</h3>
      <dl class="keyboard-mappings">
        <dt>j</dt>
        <dd>Move selection down</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>k</dt>
        <dd>Move selection up</dd>
      </dl>
      <dl class="keyboard-mappings">
        <dt>o <em>or</em> enter</dt>
        <dd>Open issue</dd>
      </dl>
    </div><!-- /.columns.last -->

  </div><!-- /.columns.equacols -->

  <div style='display:none'>
    <div class="rule"></div>

    <h3>Issues</h3>

    <div class="columns threecols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt>j</dt>
          <dd>Move selection down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>k</dt>
          <dd>Move selection up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>x</dt>
          <dd>Toggle selection</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>o <em>or</em> enter</dt>
          <dd>Open issue</dd>
        </dl>
      </div><!-- /.column.first -->
      <div class="column middle">
        <dl class="keyboard-mappings">
          <dt>I</dt>
          <dd>Mark selection as read</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>U</dt>
          <dd>Mark selection as unread</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>y</dt>
          <dd>Remove selection from view</dd>
        </dl>
      </div><!-- /.column.middle -->
      <div class="column last">
        <dl class="keyboard-mappings">
          <dt>c</dt>
          <dd>Create issue</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>l</dt>
          <dd>Create label</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>i</dt>
          <dd>Back to inbox</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>u</dt>
          <dd>Back to issues</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>/</dt>
          <dd>Focus issues search</dd>
        </dl>
      </div>
    </div>
  </div>

  <div style='display:none'>
    <div class="rule"></div>

    <h3>Issues Dashboard</h3>

    <div class="columns threecols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt>j</dt>
          <dd>Move selection down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>k</dt>
          <dd>Move selection up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>o <em>or</em> enter</dt>
          <dd>Open issue</dd>
        </dl>
      </div><!-- /.column.first -->
    </div>
  </div>

  <div style='display:none'>
    <div class="rule"></div>

    <h3>Network Graph</h3>
    <div class="columns equacols">
      <div class="column first">
        <dl class="keyboard-mappings">
          <dt><span class="badmono">←</span> <em>or</em> h</dt>
          <dd>Scroll left</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="badmono">→</span> <em>or</em> l</dt>
          <dd>Scroll right</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="badmono">↑</span> <em>or</em> k</dt>
          <dd>Scroll up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt><span class="badmono">↓</span> <em>or</em> j</dt>
          <dd>Scroll down</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>t</dt>
          <dd>Toggle visibility of head labels</dd>
        </dl>
      </div><!-- /.column.first -->
      <div class="column last">
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">←</span> <em>or</em> shift h</dt>
          <dd>Scroll all the way left</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">→</span> <em>or</em> shift l</dt>
          <dd>Scroll all the way right</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">↑</span> <em>or</em> shift k</dt>
          <dd>Scroll all the way up</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>shift <span class="badmono">↓</span> <em>or</em> shift j</dt>
          <dd>Scroll all the way down</dd>
        </dl>
      </div><!-- /.column.last -->
    </div>
  </div>

  <div >
    <div class="rule"></div>
    <div class="columns threecols">
      <div class="column first" >
        <h3>Source Code Browsing</h3>
        <dl class="keyboard-mappings">
          <dt>t</dt>
          <dd>Activates the file finder</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>l</dt>
          <dd>Jump to line</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>w</dt>
          <dd>Switch branch/tag</dd>
        </dl>
        <dl class="keyboard-mappings">
          <dt>y</dt>
          <dd>Expand URL to its canonical form</dd>
        </dl>
      </div>
    </div>
  </div>
</div>

    <div id="markdown-help" class="instapaper_ignore readability-extra">
  <h2>Markdown Cheat Sheet</h2>

  <div class="cheatsheet-content">

  <div class="mod">
    <div class="col">
      <h3>Format Text</h3>
      <p>Headers</p>
      <pre>
# This is an &lt;h1&gt; tag
## This is an &lt;h2&gt; tag
###### This is an &lt;h6&gt; tag</pre>
     <p>Text styles</p>
     <pre>
*This text will be italic*
_This will also be italic_
**This text will be bold**
__This will also be bold__

*You **can** combine them*
</pre>
    </div>
    <div class="col">
      <h3>Lists</h3>
      <p>Unordered</p>
      <pre>
* Item 1
* Item 2
  * Item 2a
  * Item 2b</pre>
     <p>Ordered</p>
     <pre>
1. Item 1
2. Item 2
3. Item 3
   * Item 3a
   * Item 3b</pre>
    </div>
    <div class="col">
      <h3>Miscellaneous</h3>
      <p>Images</p>
      <pre>
![GitHub Logo](/images/logo.png)
Format: ![Alt Text](url)
</pre>
     <p>Links</p>
     <pre>
http://github.com - automatic!
[GitHub](http://github.com)</pre>
<p>Blockquotes</p>
     <pre>
As Kanye West said:

> We're living the future so
> the present is our past.
</pre>
    </div>
  </div>
  <div class="rule"></div>

  <h3>Code Examples in Markdown</h3>
  <div class="col">
      <p>Syntax highlighting with <a href="http://github.github.com/github-flavored-markdown/" title="GitHub Flavored Markdown" target="_blank">GFM</a></p>
      <pre>
```javascript
function fancyAlert(arg) {
  if(arg) {
    $.facebox({div:'#foo'})
  }
}
```</pre>
    </div>
    <div class="col">
      <p>Or, indent your code 4 spaces</p>
      <pre>
Here is a Python code example
without syntax highlighting:

    def foo:
      if not bar:
        return true</pre>
    </div>
    <div class="col">
      <p>Inline code for comments</p>
      <pre>
I think you should use an
`&lt;addr&gt;` element here instead.</pre>
    </div>
  </div>

  </div>
</div>


    <div class="ajax-error-message">
      <p><span class="icon"></span> Something went wrong with that request. Please try again. <a href="javascript:;" class="ajax-error-dismiss">Dismiss</a></p>
    </div>

    <div id="logo-popup">
      <h2>Looking for the GitHub logo?</h2>
      <ul>
        <li>
          <h4>GitHub Logo</h4>
          <a href="http://github-media-downloads.s3.amazonaws.com/GitHub_Logos.zip"><img alt="Github_logo" src="https://a248.e.akamai.net/assets.github.com/images/modules/about_page/github_logo.png?1310104853" /></a>
          <a href="http://github-media-downloads.s3.amazonaws.com/GitHub_Logos.zip" class="minibutton btn-download download"><span><span class="icon"></span>Download</span></a>
        </li>
        <li>
          <h4>The Octocat</h4>
          <a href="http://github-media-downloads.s3.amazonaws.com/Octocats.zip"><img alt="Octocat" src="https://a248.e.akamai.net/assets.github.com/images/modules/about_page/octocat.png?1310104853" /></a>
          <a href="http://github-media-downloads.s3.amazonaws.com/Octocats.zip" class="minibutton btn-download download"><span><span class="icon"></span>Download</span></a>
        </li>
      </ul>
    </div>

    
    
    
    <span id='server_response_time' data-time='0.09164' data-host='fe8'></span>
  </body>
</html>

